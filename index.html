<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Camera Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <style>
    html, body { margin:0; padding:0; height:100%; background:black; }
    canvas { display:block; }
    #flipBtn {
      position: fixed; bottom: 20px; right: 20px;
      width: 60px; height: 60px; border-radius: 50%;
      background: rgba(200,200,200,0.6); border: 2px solid white;
      z-index: 10; cursor: pointer;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
</head>
<body>
  <button id="flipBtn">↺</button>
<script>
let video, facingMode = "environment";

function setup() {
  createCanvas(windowWidth, windowHeight);
  pixelDensity(1);
  startCamera();

  document.getElementById("flipBtn").onclick = () => {
    facingMode = (facingMode === "environment") ? "user" : "environment";
    if (video) video.remove();
    startCamera();
  };
}

function startCamera() {
  video = createCapture({ video: { facingMode: facingMode }, audio: false });
  video.elt.setAttribute("playsinline", ""); // required for iOS Safari
  video.size(640, 480);
  video.hide();
}

function draw() {
  background(0);
  if (video && video.loadedmetadata) {
    // Keep aspect ratio, crop to fill
    let camRatio = video.width / video.height;
    let canvasRatio = width / height;
    let drawW, drawH;
    if (camRatio > canvasRatio) {
      // video wider than canvas → crop sides
      drawH = height;
      drawW = camRatio * height;
    } else {
      // video taller → crop top/bottom
      drawW = width;
      drawH = width / camRatio;
    }
    image(video, width/2 - drawW/2, height/2 - drawH/2, drawW, drawH);
  } else {
    fill(255);
    textAlign(CENTER, CENTER);
    text("Waiting for camera…", width/2, height/2);
  }
}
</script>
</body>
</html>
